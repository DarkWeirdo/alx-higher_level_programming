#!/usr/bin/env bash
# This script checks if Nginx is installed and running, and ensures it's configured to listen on port 80 using service instead of systemctl.

# Check if Nginx is installed
if ! which nginx > /dev/null; then
    echo "Nginx is not installed. Installing Nginx..."
    apt-get update && apt-get install -y nginx
fi

# Check if Nginx is running
if ! service nginx status | grep -q 'active (running)'; then
    echo "Nginx is not running. Starting Nginx..."
    service nginx start
fi

# Check if Nginx is configured to listen on port 80
if ! grep -q 'listen 80;' /etc/nginx/sites-available/default; then
    echo "Nginx is not configured to listen on port 80. Configuring..."
    echo "server {
    listen 80 default_server;
    listen [::]:80 default_server;

    root /var/www/html;
    index index.html index.htm index.nginx-debian.html;

    server_name _;

    location / {
        try_files \$uri \$uri/ =404;
    }
}" > /etc/nginx/sites-available/default
    service nginx reload
fi

echo "Nginx is now configured to listen on port 80."
